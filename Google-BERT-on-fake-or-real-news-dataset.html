<!DOCTYPE html>
<html  lang="en">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 4.0.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Google-BERT-on-fake_or_real-news-dataset - It Ain&#39;t me</title>


    <meta name="description" content="Description: Use Google BERT on fake_or_real news dataset with best f1 score: 0.986">
<meta name="keywords" content="NLP,Python">
<meta property="og:type" content="article">
<meta property="og:title" content="Google-BERT-on-fake_or_real-news-dataset">
<meta property="og:url" content="https:&#x2F;&#x2F;nave.work&#x2F;Google-BERT-on-fake-or-real-news-dataset.html">
<meta property="og:site_name" content="It Ain&#39;t me">
<meta property="og:description" content="Description: Use Google BERT on fake_or_real news dataset with best f1 score: 0.986">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;images.unsplash.com&#x2F;photo-1542827866-3e48c943da0f?ixlib&#x3D;rb-1.2.1&amp;ixid&#x3D;eyJhcHBfaWQiOjEyMDd9&amp;auto&#x3D;format&amp;fit&#x3D;crop&amp;w&#x3D;800&amp;q&#x3D;60">
<meta property="og:updated_time" content="2020-02-15T16:00:04.976Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;images.unsplash.com&#x2F;photo-1542827866-3e48c943da0f?ixlib&#x3D;rb-1.2.1&amp;ixid&#x3D;eyJhcHBfaWQiOjEyMDd9&amp;auto&#x3D;format&amp;fit&#x3D;crop&amp;w&#x3D;800&amp;q&#x3D;60">





<link rel="alternative" href="https://navepnow.github.io/atom.xml" title="Google-BERT-on-fake_or_real-news-dataset" type="application/atom+xml">



<link rel="icon" href="/images/favicon1.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145418865-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-145418865-1');
</script>

    
    
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

<script src="/js/globalUtils.js"></script>
<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="Google-BERT-on-fake_or_real-news-dataset" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">Home</a>
                
                <a class="navbar-item"
                href="/about">About</a>
                
                <a class="navbar-item"
                href="/archives">Articles</a>
                
                <a class="navbar-item"
                href="/gallery">Gallery</a>
                
                <a class="navbar-item"
                href="/books">Books</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;" target="_blank" rel="noopener">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                <a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;" target="_blank" onclick='return false;'>
                                    <i class="fas fa-moon" id="night-icon"></i>
                </a>
                
                <a class="navbar-item search" title="Search" href="javascript:;" target="_blank" rel="noopener">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    <script type="text/javascript" src="/js/theme-setting.js"></script>
     
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-9-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="https://images.unsplash.com/photo-1542827866-3e48c943da0f?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=800&amp;q=60" alt="Google-BERT-on-fake_or_real-news-dataset">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-08-23T03:59:01.000Z">2019-08-23</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/FakeNews/">FakeNews</a>
                </div>
                
                
                    
                    <span class="level-item has-text-grey">
                        
                        
                        19 minutes read (About 2824 words)
                    </span>
                
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Google-BERT-on-fake_or_real-news-dataset
            
        </h1>
        <div class="content">
            <p><strong>Description</strong>: Use Google BERT on fake_or_real news dataset with best f1 score: 0.986</p>
<a id="more"></a>
<h2 id="Showcase"><a href="#Showcase" class="headerlink" title="Showcase"></a>Showcase</h2><h3 id="1-Pipeline"><a href="#1-Pipeline" class="headerlink" title="1. Pipeline"></a>1. Pipeline</h3><p><img src="https://i.loli.net/2019/08/23/P8Seo5EvmpZfAOT.png" alt="Pipeline"></p>
<p>First, we got the raw text with title, text and label. Then we use some methods of data processing to operate the text. After the data processing, we put them into the Bert model to train the data, which includes the Bert itself and the Classifier, here I used the feed-forward neural network and add a softmax layer to normalize the output. In the end, we got the predication and other details.</p>
<h3 id="2-Part1-Data-processing"><a href="#2-Part1-Data-processing" class="headerlink" title="2. Part1: Data processing"></a>2. Part1: Data processing</h3><p>(1) <strong>Drop non-sentence</strong></p>
<pre><code>‚Ä¢ Type1: http[s]://www.claritypress.com/LendmanIII.html
‚Ä¢ Type2: [email protected]
‚Ä¢ Type3: @EP_President #EP_President 
‚Ä¢ Type4: **Want FOX News First * in your inbox every day? Sign up here.**
‚Ä¢ Type5: ‚òÆÔ∏è üíö üåç etc</code></pre><p>(2) <strong>EDA methods</strong></p>
<pre><code>‚Ä¢ Insert word by BERT similarity (Random Insertion)
‚Ä¢ Substitute word by BERT similarity (Synonym Replacement)</code></pre><p>AS for the first part, I use two methods: drop non-sentence and some EDA methods. I read some text within the fake_or_real news and I find that it contains various type of non-sentence, so I use the regular expression to drop them. And then, I use random insertion and synonym replacement to augment the text.</p>
<h3 id="3-Part2-Bert-Model"><a href="#3-Part2-Bert-Model" class="headerlink" title="3. Part2: Bert Model"></a>3. Part2: Bert Model</h3><p><img src="https://i.loli.net/2019/08/23/pFv1K86WUcafyDI.png" alt="Bert model"></p>
<p>As for the second part, we put the text which we got from the first part into the bert model. The Bert model uses 12 encode layers and finally classifier to get the output.</p>
<h3 id="4-Part3-Result"><a href="#4-Part3-Result" class="headerlink" title="4. Part3: Result"></a>4. Part3: Result</h3><p><img src="https://i.loli.net/2019/08/23/aGTYdfz2cul1pj3.png" alt="Result"></p>
<p>In the end, we combine different methods of data processing and u can see the f1 score from the chart. We get the best f1 score(0.986) from Cased text + drop sentence.</p>
<h3 id="5-Part4-Reference"><a href="#5-Part4-Reference" class="headerlink" title="5. Part4: Reference"></a>5. Part4: Reference</h3><p>(1) <strong>EDA</strong>: </p>
<pre><code>‚Ä¢Knowledge: https://towardsdatascience.com/these-are-the-easiest-data-augmentation-techniques-in-natural-language-processing-you-can-think-of-88e393fd610
‚Ä¢Implemenation: https://github.com/makcedward/nlpaug</code></pre><p>(2) <strong>Can‚Äôt remove stopwords</strong>: </p>
<pre><code>‚Ä¢Deeper Text Understanding for IR with Contextual NeuralLanguage Modeling: https://arxiv.org/pdf/1905.09217
‚Ä¢Understanding the Behaviors of BERT in Ranking : https://arxiv.org/pdf/1904.07531</code></pre><p>(3) <strong>Bert by Pytorch</strong>:</p>
<pre><code>‚Ä¢https://pytorch.org/hub/huggingface_pytorch-pretrained-bert_bert/</code></pre><p>(4) <strong>Bert Demo</strong>:</p>
<pre><code>https://github.com/sugi-chan/custom_bert_pipeline</code></pre><p>(5) <strong>Dataset</strong>:</p>
<pre><code>https://cbmm.mit.edu/sites/default/files/publications/fake-news-paper-NIPS.pdf</code></pre><p>I learn the EDA from the two web site and through two articles, I learn that we shouldn‚Äôt remove Stopwords which otherwise will destroy the context of sentence. The end is implementation of BERT with Pytorch and the Bert model I learned.</p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><h3 id="1-Preparation"><a href="#1-Preparation" class="headerlink" title="1. Preparation"></a>1. Preparation</h3><h4 id="1-1-Set-parameters-and-install-and-load-required-package"><a href="#1-1-Set-parameters-and-install-and-load-required-package" class="headerlink" title="1.1 Set parameters and install and load required package"></a>1.1 Set parameters and install and load required package</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">### parameters Setting</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">par_cased = <span class="hljs-number">0</span> <span class="hljs-comment"># default cased, 0 means uncased</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">par_cleanup = <span class="hljs-number">1</span> <span class="hljs-comment"># default cleanup, 0 means non-cleanup</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">par_eda = <span class="hljs-number">0</span> <span class="hljs-comment"># default eda, 0 means non-eda</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">pip install pytorch_pretrained_bert nlpaug bert matplotlib sklearn librosa SoundFile nltk pandas</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function, division</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torch</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torch.optim <span class="hljs-keyword">as</span> optim</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> lr_scheduler</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torchvision</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> datasets, models, transforms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> time</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> os</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> copy</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset, DataLoader</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randrange</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> roc_curve, auc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> nlpaug.augmenter.char <span class="hljs-keyword">as</span> nac</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#import nlpaug.augmenter.word as naw</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> nlpaug.flow <span class="hljs-keyword">as</span> naf</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> nlpaug.util <span class="hljs-keyword">import</span> Action</span></pre></td></tr></table></figure>
<h4 id="1-2-Set-tokenizer"><a href="#1-2-Set-tokenizer" class="headerlink" title="1.2 Set tokenizer"></a>1.2 Set tokenizer</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torch</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> pytorch_pretrained_bert <span class="hljs-keyword">import</span> BertTokenizer, BertModel, BertForMaskedLM</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># OPTIONAL: if you want to have more information on what's happening, activate the logger as follows</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> logging</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.INFO)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># Load pre-trained model tokenizer (vocabulary)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> par_cased ==<span class="hljs-number">1</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    tokenizer = BertTokenizer.from_pretrained(<span class="hljs-string">'bert-base-cased'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">else</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    tokenizer = BertTokenizer.from_pretrained(<span class="hljs-string">'bert-base-uncased'</span>)</span></pre></td></tr></table></figure>
<h4 id="1-3-Define-Bert-Config"><a href="#1-3-Define-Bert-Config" class="headerlink" title="1.3 Define Bert Config"></a>1.3 Define Bert Config</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BertLayerNorm</span><span class="hljs-params">(nn.Module)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, hidden_size, eps=<span class="hljs-number">1e-12</span>)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">            <span class="hljs-string">"""Construct a layernorm module in the TF style (epsilon inside the square root).</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            """</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            super(BertLayerNorm, self).__init__()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">            self.weight = nn.Parameter(torch.ones(hidden_size))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">            self.bias = nn.Parameter(torch.zeros(hidden_size))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">            self.variance_epsilon = eps</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(self, x)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">            u = x.mean(<span class="hljs-number">-1</span>, keepdim=<span class="hljs-literal">True</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">            s = (x - u).pow(<span class="hljs-number">2</span>).mean(<span class="hljs-number">-1</span>, keepdim=<span class="hljs-literal">True</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            x = (x - u) / torch.sqrt(s + self.variance_epsilon)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">            <span class="hljs-keyword">return</span> self.weight * x + self.bias</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BertForSequenceClassification</span><span class="hljs-params">(nn.Module)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-string">"""BERT model for classification.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    This module is composed of the BERT model with a linear layer on top of</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    the pooled output.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    Params:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        `config`: a BertConfig class instance with the configuration to build a new model.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        `num_labels`: the number of classes for the classifier. Default = 2.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    Inputs:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        `input_ids`: a torch.LongTensor of shape [batch_size, sequence_length]</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            with the word token indices in the vocabulary. Items in the batch should begin with the special "CLS" token. (see the tokens preprocessing logic in the scripts</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            `extract_features.py`, `run_classifier.py` and `run_squad.py`)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        `token_type_ids`: an optional torch.LongTensor of shape [batch_size, sequence_length] with the token</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            types indices selected in [0, 1]. Type 0 corresponds to a `sentence A` and type 1 corresponds to</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            a `sentence B` token (see BERT paper for more details).</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        `attention_mask`: an optional torch.LongTensor of shape [batch_size, sequence_length] with indices</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            selected in [0, 1]. It's a mask to be used if the input sequence length is smaller than the max</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            input sequence length in the current batch. It's the mask that we typically use for attention when</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            a batch has varying length sentences.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        `labels`: labels for the classification output: torch.LongTensor of shape [batch_size]</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            with indices selected in [0, ..., num_labels].</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    Outputs:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        if `labels` is not `None`:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            Outputs the CrossEntropy classification loss of the output with the labels.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        if `labels` is `None`:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            Outputs the classification logits of shape [batch_size, num_labels].</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    Example usage:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    ```python</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    # Already been converted into WordPiece token ids</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    input_ids = torch.LongTensor([[31, 51, 99], [15, 5, 0]])</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    input_mask = torch.LongTensor([[1, 1, 1], [1, 1, 0]])</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    token_type_ids = torch.LongTensor([[0, 0, 1], [0, 1, 0]])</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    config = BertConfig(vocab_size_or_config_json_file=32000, hidden_size=768,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        num_hidden_layers=12, num_attention_heads=12, intermediate_size=3072)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    num_labels = 2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    model = BertForSequenceClassification(config, num_labels)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    logits = model(input_ids, token_type_ids, input_mask)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    def __init__(self, num_labels=2):</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        super(BertForSequenceClassification, self).__init__()</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        self.num_labels = num_labels</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        if par_cased ==1:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            self.bert = BertModel.from_pretrained('bert-base-cased')</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        else:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            self.bert = BertModel.from_pretrained('bert-base-uncased')</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        self.dropout = nn.Dropout(config.hidden_dropout_prob)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        self.classifier = nn.Linear(config.hidden_size, num_labels)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        nn.init.xavier_normal_(self.classifier.weight)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    def forward(self, input_ids, token_type_ids=None, attention_mask=None, labels=None):</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        _, pooled_output = self.bert(input_ids, token_type_ids, attention_mask, output_all_encoded_layers=False)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        pooled_output = self.dropout(pooled_output)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        logits = self.classifier(pooled_output)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        return logits</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    def freeze_bert_encoder(self):</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        for param in self.bert.parameters():</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            param.requires_grad = False</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">    def unfreeze_bert_encoder(self):</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        for param in self.bert.parameters():</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">            param.requires_grad = True</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">from pytorch_pretrained_bert import BertConfig</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">config = BertConfig(vocab_size_or_config_json_file=32000, hidden_size=768,</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">        num_hidden_layers=12, num_attention_heads=12, intermediate_size=3072)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">num_labels = 2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">model = BertForSequenceClassification(num_labels)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"># Convert inputs to PyTorch tensors</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">#tokens_tensor = torch.tensor([tokenizer.convert_tokens_to_ids(zz)])</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string"></span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-string">#logits = model(tokens_tensor)</span></span></pre></td></tr></table></figure>

<h3 id="2-Dataset-Processing"><a href="#2-Dataset-Processing" class="headerlink" title="2. Dataset Processing"></a>2. Dataset Processing</h3><h4 id="2-1-Read-the-data-and-convert-label-into-binary-text"><a href="#2-1-Read-the-data-and-convert-label-into-binary-text" class="headerlink" title="2.1 Read the data and convert label into binary text"></a>2.1 Read the data and convert label into binary text</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">dat = pd.read_csv(<span class="hljs-string">'/data/fake_or_real_news.csv'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">dat.head()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">dat = dat.drop(columns=[<span class="hljs-string">'Unnamed: 0'</span>, <span class="hljs-string">'title_vectors'</span>])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(dat)):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> dat.loc[i, <span class="hljs-string">'label'</span>] == <span class="hljs-string">"REAL"</span>: <span class="hljs-comment">#REAL equal 0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        dat.loc[i, <span class="hljs-string">'label'</span>] = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">elif</span> dat.loc[i, <span class="hljs-string">'label'</span>] == <span class="hljs-string">"FAKE"</span>: <span class="hljs-comment">#FAKE equal 1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        dat.loc[i, <span class="hljs-string">'label'</span>] = <span class="hljs-number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> dat.loc[i, <span class="hljs-string">'text'</span>] == <span class="hljs-string">""</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        dat = dat.drop([i])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">dat.head()</span></pre></td></tr></table></figure>
<h4 id="2-2-Combine-the-title-and-text"><a href="#2-2-Combine-the-title-and-text" class="headerlink" title="2.2 Combine the title and text"></a>2.2 Combine the title and text</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">dat_plus = dat.copy()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">dat_plus[<span class="hljs-string">'title_text'</span>]=dat[<span class="hljs-string">'title'</span>]+<span class="hljs-string">'. '</span>+dat[<span class="hljs-string">'text'</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">dat_plus = dat_plus.drop(columns=[<span class="hljs-string">'title'</span>, <span class="hljs-string">'text'</span>])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">dat_plus[<span class="hljs-string">'title_text'</span>]</span></pre></td></tr></table></figure>
<h4 id="2-3-Use-regular-expression-to-drop-non-sentence"><a href="#2-3-Use-regular-expression-to-drop-non-sentence" class="headerlink" title="2.3 Use regular expression to drop non-sentence"></a>2.3 Use regular expression to drop non-sentence</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> re</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cleanup</span><span class="hljs-params">(text)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> par_cased == <span class="hljs-number">0</span>: <span class="hljs-comment"># transfer into lower text if par_cased is false</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        text = text.lower()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">r'http[s]?://(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+'</span>,<span class="hljs-string">''</span>,text) <span class="hljs-comment"># drop http[s]://*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"\\&#123;.*?&#125;|\\[.*?]"</span>,<span class="hljs-string">''</span>,text) <span class="hljs-comment"># drop [*]</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"\(\@.*?\s"</span>, <span class="hljs-string">''</span>, text) <span class="hljs-comment"># drop something like (@EP_President)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"\@.*?\s"</span>, <span class="hljs-string">''</span>, text) <span class="hljs-comment"># drop soething liek @EP_President</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"\#.*?\s"</span>, <span class="hljs-string">''</span>, text) <span class="hljs-comment"># drop something like #EP_President (maybe hashtag)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"\¬© .*?\s"</span>, <span class="hljs-string">''</span>, text) <span class="hljs-comment"># drop something like ¬© EP_President</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">r'pic.tw(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+#]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+'</span>,<span class="hljs-string">''</span>,text) <span class="hljs-comment"># drop pic.twitter.com/*</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"\*\*"</span>, <span class="hljs-string">''</span>, text) <span class="hljs-comment"># drop something like **Want FOX News First * in your inbox every day? Sign up here.**</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    text = re.sub(<span class="hljs-string">u"ÔÇ∑|‚Ä¢|‚òÆÔ∏è|üíö|üåç|üòç|‚ô¶|‚ò¢"</span>, <span class="hljs-string">''</span>, text) <span class="hljs-comment"># drop something like ÔÇ∑ and ‚Ä¢ etc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">return</span>(text)</span></pre></td></tr></table></figure>
<h4 id="2-4-Use-EDA-method-to-augment-the-text"><a href="#2-4-Use-EDA-method-to-augment-the-text" class="headerlink" title="2.4 Use EDA method to augment the text"></a>2.4 Use EDA method to augment the text</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> nlpaug.augmenter.char <span class="hljs-keyword">as</span> nac</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> nlpaug.augmenter.word <span class="hljs-keyword">as</span> naw</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> nlpaug.flow <span class="hljs-keyword">as</span> nafc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> nlpaug.util <span class="hljs-keyword">import</span> Action</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> nltk</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">nltk.download(<span class="hljs-string">'punkt'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> par_cased ==<span class="hljs-number">1</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    aug = naf.Sequential([</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">        naw.BertAug(action=<span class="hljs-string">"substitute"</span>, aug_p=<span class="hljs-number">0.8</span>, aug_n=<span class="hljs-number">20</span>,model_path=<span class="hljs-string">'bert-base-cased'</span>,tokenizer_path=<span class="hljs-string">'bert-base-cased'</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">        naw.BertAug(action=<span class="hljs-string">"insert"</span>, aug_p=<span class="hljs-number">0.1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    ])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">else</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    aug = naf.Sequential([</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">        naw.BertAug(action=<span class="hljs-string">"substitute"</span>, aug_p=<span class="hljs-number">0.8</span>, aug_n=<span class="hljs-number">20</span>,model_path=<span class="hljs-string">'bert-base-uncased'</span>,tokenizer_path=<span class="hljs-string">'bert-base-uncased'</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        naw.BertAug(action=<span class="hljs-string">"insert"</span>, aug_p=<span class="hljs-number">0.1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">    ])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">aug_text</span><span class="hljs-params">(text)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    text = aug.augment(text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">return</span>(text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> nltk.tokenize <span class="hljs-keyword">import</span> sent_tokenize</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sentence_token_nltk</span><span class="hljs-params">(text)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    sent_tokenize_list = sent_tokenize(text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">return</span> sent_tokenize_list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">eda_text</span><span class="hljs-params">(text)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> len(text) &lt; <span class="hljs-number">2</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">return</span>(text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-comment"># split text into sentences</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">    text = sentence_token_nltk(text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> len(text) &lt;= <span class="hljs-number">1</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">return</span>(text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> len(text) == <span class="hljs-number">2</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(text)):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">            <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">                tmp_text = text[i]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">            <span class="hljs-keyword">else</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">                tmp_text += text[i]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">return</span>(tmp_text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-comment"># operate prior 3 sentences</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">3</span>):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">            tmp_text = text[i]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">else</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">            tmp_text += text[i]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">    zz = tokenizer.tokenize(tmp_text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-comment"># operate proper sentences</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">if</span> len(zz) &lt;= <span class="hljs-number">500</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-comment">#print(len(zz))</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">        tmp_text = aug_text(tmp_text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-comment"># conbine prior 3 sentences and rest sentences</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(len(text)<span class="hljs-number">-3</span>):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">        tmp_text += text[j+<span class="hljs-number">3</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-keyword">return</span>(tmp_text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> par_eda == <span class="hljs-number">1</span>: <span class="hljs-comment"># use eda to operate sentences when par_eda is true</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(dat_plus[<span class="hljs-string">'title_text'</span>])):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">      <span class="hljs-keyword">if</span> i%<span class="hljs-number">6</span> == <span class="hljs-number">1</span>:       </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">          <span class="hljs-comment">#print(i)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">          dat_plus[<span class="hljs-string">'title_text'</span>][i] = copy.deepcopy(eda_text(dat_plus[<span class="hljs-string">'title_text'</span>][i]))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">          dat_plus[<span class="hljs-string">'title_text'</span>][i] = <span class="hljs-string">""</span>.join(dat_plus[<span class="hljs-string">'title_text'</span>][i])</span></pre></td></tr></table></figure>
<h3 id="3-Google-Bert"><a href="#3-Google-Bert" class="headerlink" title="3. Google Bert"></a>3. Google Bert</h3><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#F.softmax(logits,dim=1)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">if</span> par_cleanup == <span class="hljs-number">1</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    X = dat_plus[<span class="hljs-string">'title_text'</span>].apply(cleanup)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">else</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    X = dat_plus[<span class="hljs-string">'title_text'</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">y = dat_plus[<span class="hljs-string">'label'</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number">0.3</span>, random_state=<span class="hljs-number">42</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">X_train = X_train.values.tolist()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">X_test = X_test.values.tolist()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">y_train = pd.get_dummies(y_train).values.tolist() <span class="hljs-comment"># convert to one-hot encoding</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">y_test = pd.get_dummies(y_test).values.tolist()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">max_seq_length = <span class="hljs-number">256</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">text_dataset</span><span class="hljs-params">(Dataset)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,x_y_list, transform=None)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        self.x_y_list = x_y_list</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">        self.transform = transform</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span><span class="hljs-params">(self,index)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">        tokenized_title_text = tokenizer.tokenize(self.x_y_list[<span class="hljs-number">0</span>][index])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">if</span> len(tokenized_title_text) &gt; max_seq_length:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">            tokenized_title_text = tokenized_title_text[:max_seq_length]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">            </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">        ids_title_text  = tokenizer.convert_tokens_to_ids(tokenized_title_text) <span class="hljs-comment">#tokens-&gt;input_ids</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">        padding = [<span class="hljs-number">0</span>] * (max_seq_length - len(ids_title_text))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">        ids_title_text += padding <span class="hljs-comment"># use padding to make the same ids</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">assert</span> len(ids_title_text) == max_seq_length</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-comment">#print(ids_title_text)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">        ids_title_text = torch.tensor(ids_title_text)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">        label = self.x_y_list[<span class="hljs-number">1</span>][index] <span class="hljs-comment"># color        </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">        list_of_labels = [torch.from_numpy(np.array(label))]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line">        </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">return</span> ids_title_text, list_of_labels[<span class="hljs-number">0</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">    </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span><span class="hljs-params">(self)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">        <span class="hljs-keyword">return</span> len(self.x_y_list[<span class="hljs-number">0</span>])</span></pre></td></tr></table></figure>
<h4 id="3-1-Create-data-dictionary"><a href="#3-1-Create-data-dictionary" class="headerlink" title="3.1 Create data dictionary"></a>3.1 Create data dictionary</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">batch_size = <span class="hljs-number">16</span> <span class="hljs-comment"># divide into 16 batches</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">train_lists = [X_train, y_train]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">test_lists = [X_test, y_test]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">training_dataset = text_dataset(x_y_list = train_lists )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">test_dataset = text_dataset(x_y_list = test_lists )</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">dataloaders_dict = &#123;<span class="hljs-string">'train'</span>: torch.utils.data.DataLoader(training_dataset, batch_size=batch_size, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">0</span>),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-string">'val'</span>:torch.utils.data.DataLoader(test_dataset, batch_size=batch_size, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">                  &#125;                </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">dataset_sizes = &#123;<span class="hljs-string">'train'</span>:len(train_lists[<span class="hljs-number">0</span>]),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">                <span class="hljs-string">'val'</span>:len(test_lists[<span class="hljs-number">0</span>])&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">device = torch.device(<span class="hljs-string">"cuda:0"</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">"cpu"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">print(device)</span></pre></td></tr></table></figure>

<h4 id="3-2-Define-the-train-model"><a href="#3-2-Define-the-train-model" class="headerlink" title="3.2 Define the train model"></a>3.2 Define the train model</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">train_model</span><span class="hljs-params">(model, criterion, optimizer, scheduler, num_epochs=<span class="hljs-number">25</span>)</span>:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">   since = time.time()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">'starting'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">   best_model_wts = copy.deepcopy(model.state_dict())</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   best_loss = <span class="hljs-number">100</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   best_f1 = <span class="hljs-number">0.978</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">   best_acc_test = <span class="hljs-number">0.96</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">   best_acc_train = <span class="hljs-number">0.96</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">   best_auc = <span class="hljs-number">0.96</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">   <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(num_epochs):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">       print(<span class="hljs-string">'Epoch &#123;&#125;/&#123;&#125;'</span>.format(epoch, num_epochs - <span class="hljs-number">1</span>))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">       print(<span class="hljs-string">'-'</span> * <span class="hljs-number">10</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">       <span class="hljs-comment"># Each epoch has a training and validation phase</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">       <span class="hljs-keyword">for</span> phase <span class="hljs-keyword">in</span> [<span class="hljs-string">'train'</span>, <span class="hljs-string">'val'</span>]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> phase == <span class="hljs-string">'train'</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">               scheduler.step()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">               model.train()  <span class="hljs-comment"># Set model to training mode</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">else</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">               model.eval()   <span class="hljs-comment"># Set model to evaluate mode</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">           running_loss = <span class="hljs-number">0.0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">           </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">           label_corrects = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">           TP = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">           TN = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">           FN = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">           FP = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">           total_scores = []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">           total_tar = []</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-comment"># Iterate over data.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">for</span> inputs, label <span class="hljs-keyword">in</span> dataloaders_dict[phase]:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment">#inputs = inputs</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment">#print(len(inputs),type(inputs),inputs)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">35</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment">#inputs = torch.from_numpy(np.array(inputs)).to(device) </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">36</span></pre></td><td class="code"><pre><span class="line">               inputs = inputs.to(device) </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">37</span></pre></td><td class="code"><pre><span class="line">               label = label.to(device)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">38</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">39</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># zero the parameter gradients</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">40</span></pre></td><td class="code"><pre><span class="line">               optimizer.zero_grad()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">41</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">42</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># forward</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">43</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># track history if only in train</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">44</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-keyword">with</span> torch.set_grad_enabled(phase == <span class="hljs-string">'train'</span>):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">45</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-comment"># acquire output</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">46</span></pre></td><td class="code"><pre><span class="line">                   outputs = model(inputs)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">47</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">48</span></pre></td><td class="code"><pre><span class="line">                   outputs = F.softmax(outputs,dim=<span class="hljs-number">1</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">49</span></pre></td><td class="code"><pre><span class="line">                   </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">50</span></pre></td><td class="code"><pre><span class="line">                   loss = criterion(outputs, torch.max(label.float(), <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>])</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">51</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-comment"># backward + optimize only if in training phase</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">52</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-keyword">if</span> phase == <span class="hljs-string">'train'</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">53</span></pre></td><td class="code"><pre><span class="line">                       </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">54</span></pre></td><td class="code"><pre><span class="line">                       loss.backward()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">55</span></pre></td><td class="code"><pre><span class="line">                       optimizer.step()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">56</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">57</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># statistics</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">58</span></pre></td><td class="code"><pre><span class="line">               running_loss += loss.item() * inputs.size(<span class="hljs-number">0</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">59</span></pre></td><td class="code"><pre><span class="line">               label_corrects += torch.sum(torch.max(outputs, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>] == torch.max(label, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]) <span class="hljs-comment">#ËøîÂõûÊØè‰∏ÄË°å‰∏≠ÊúÄÂ§ßÂÄºÁöÑÈÇ£‰∏™ÂÖÉÁ¥†Ôºå‰∏îËøîÂõûÂÖ∂Á¥¢ÂºïÔºàËøîÂõûÊúÄÂ§ßÂÖÉÁ¥†Âú®Ëøô‰∏ÄË°åÁöÑÂàóÁ¥¢ÂºïÔºâ</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">60</span></pre></td><td class="code"><pre><span class="line">               pred_choice = torch.max(outputs, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">61</span></pre></td><td class="code"><pre><span class="line">               target = torch.max(label, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">62</span></pre></td><td class="code"><pre><span class="line">               scores = pred_choice.cpu().tolist()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">63</span></pre></td><td class="code"><pre><span class="line">               tar = target.cpu().tolist()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">64</span></pre></td><td class="code"><pre><span class="line">               total_scores = total_scores + scores</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">65</span></pre></td><td class="code"><pre><span class="line">               total_tar = total_tar + tar</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">66</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">67</span></pre></td><td class="code"><pre><span class="line">               tmp_tp = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">68</span></pre></td><td class="code"><pre><span class="line">               tmp_tn = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">69</span></pre></td><td class="code"><pre><span class="line">               tmp_fn = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">70</span></pre></td><td class="code"><pre><span class="line">               tmp_fp = <span class="hljs-number">0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">71</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-keyword">if</span> pred_choice.numel()!= target.numel():</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">72</span></pre></td><td class="code"><pre><span class="line">                   print(<span class="hljs-string">"error"</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">73</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(pred_choice.numel()):</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">74</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-keyword">if</span> pred_choice[i] == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> target[i] == <span class="hljs-number">1</span> :</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">75</span></pre></td><td class="code"><pre><span class="line">                       tmp_tp = tmp_tp + <span class="hljs-number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">76</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-keyword">elif</span> pred_choice[i] == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> target[i] == <span class="hljs-number">0</span> :</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">77</span></pre></td><td class="code"><pre><span class="line">                       tmp_tn = tmp_tn + <span class="hljs-number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">78</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-keyword">elif</span> pred_choice[i] == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> target[i] == <span class="hljs-number">1</span> :</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">79</span></pre></td><td class="code"><pre><span class="line">                       tmp_fn = tmp_fn + <span class="hljs-number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">80</span></pre></td><td class="code"><pre><span class="line">                   <span class="hljs-keyword">elif</span> pred_choice[i] == <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> target[i] == <span class="hljs-number">0</span> :</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">81</span></pre></td><td class="code"><pre><span class="line">                       tmp_fp = tmp_fp + <span class="hljs-number">1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">82</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># TP    both predict and label are 1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">83</span></pre></td><td class="code"><pre><span class="line">               TP += tmp_tp</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">84</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># TN    both predict and label are 0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">85</span></pre></td><td class="code"><pre><span class="line">               TN += tmp_tn</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">86</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># FN    predict 0 label 1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">87</span></pre></td><td class="code"><pre><span class="line">               FN += tmp_fn</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">88</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment"># FP    predict 1 label 0</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">89</span></pre></td><td class="code"><pre><span class="line">               FP += tmp_fp</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">90</span></pre></td><td class="code"><pre><span class="line">           epoch_loss = running_loss / dataset_sizes[phase]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">91</span></pre></td><td class="code"><pre><span class="line">           p = TP / (TP + FP)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">92</span></pre></td><td class="code"><pre><span class="line">           r = TP / (TP + FN)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">93</span></pre></td><td class="code"><pre><span class="line">           F1 = <span class="hljs-number">2</span> * r * p / (r + p)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">94</span></pre></td><td class="code"><pre><span class="line">           acc = (TP + TN) / (TP + TN + FP + FN)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">95</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">96</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-comment">### draw ROC curce</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">97</span></pre></td><td class="code"><pre><span class="line">           tpr = TP/(TP+FN)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">98</span></pre></td><td class="code"><pre><span class="line">           fpr = FP/(FP+TN)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">99</span></pre></td><td class="code"><pre><span class="line">           tnr = TN/(FP+TN)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">100</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">101</span></pre></td><td class="code"><pre><span class="line">           total_scores = np.array(total_scores)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">102</span></pre></td><td class="code"><pre><span class="line">           total_tar = np.array(total_tar)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">103</span></pre></td><td class="code"><pre><span class="line">           fpr, tpr, thresholds = roc_curve(total_tar, total_scores)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">104</span></pre></td><td class="code"><pre><span class="line">           roc_auc = auc(fpr, tpr) </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">105</span></pre></td><td class="code"><pre><span class="line">           plt.title(<span class="hljs-string">'ROC'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">106</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> roc_auc &gt; best_auc:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">107</span></pre></td><td class="code"><pre><span class="line">               best_auc = roc_auc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">108</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> epoch &lt; num_epochs <span class="hljs-number">-1</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">109</span></pre></td><td class="code"><pre><span class="line">               plt.plot(fpr, tpr,<span class="hljs-string">'b'</span>,label=<span class="hljs-string">'AUC = %0.4f'</span>% roc_auc)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">110</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> epoch == num_epochs <span class="hljs-number">-1</span>:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">111</span></pre></td><td class="code"><pre><span class="line">               plt.plot(fpr, tpr, color=<span class="hljs-string">'darkorange'</span>, label=<span class="hljs-string">'MAX AUC = %0.4f'</span>% best_auc) </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">112</span></pre></td><td class="code"><pre><span class="line">           plt.legend(loc=<span class="hljs-string">'lower right'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">113</span></pre></td><td class="code"><pre><span class="line">           plt.plot([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],<span class="hljs-string">'r--'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">114</span></pre></td><td class="code"><pre><span class="line">           plt.ylabel(<span class="hljs-string">'TPR'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">115</span></pre></td><td class="code"><pre><span class="line">           plt.xlabel(<span class="hljs-string">'FPR'</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">116</span></pre></td><td class="code"><pre><span class="line">           plt.show()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">117</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">118</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-comment">#print('&#123;&#125; p: &#123;:.4f&#125; '.format(phase,p ))</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">119</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-comment">#print('&#123;&#125; r: &#123;:.4f&#125; '.format(phase,r ))</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">120</span></pre></td><td class="code"><pre><span class="line">           print(<span class="hljs-string">'&#123;&#125; F1: &#123;:.4f&#125; '</span>.format(phase,F1 ))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">121</span></pre></td><td class="code"><pre><span class="line">           print(<span class="hljs-string">'&#123;&#125; accuracy: &#123;:.4f&#125; '</span>.format(phase,acc ))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">122</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">123</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> phase == <span class="hljs-string">'val'</span> <span class="hljs-keyword">and</span> epoch_loss &lt; best_loss:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">124</span></pre></td><td class="code"><pre><span class="line">               print(<span class="hljs-string">'saving with loss of &#123;&#125;'</span>.format(epoch_loss),</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">125</span></pre></td><td class="code"><pre><span class="line">                     <span class="hljs-string">'improved over previous &#123;&#125;'</span>.format(best_loss))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">126</span></pre></td><td class="code"><pre><span class="line">               best_loss = epoch_loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">127</span></pre></td><td class="code"><pre><span class="line">               best_model_wts = copy.deepcopy(model.state_dict())</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">128</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment">#torch.save(model.state_dict(), '/content/drive/My Drive/Colab Notebooks/bert_model_test_loss.pth')</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">129</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> F1 &gt; best_f1:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">130</span></pre></td><td class="code"><pre><span class="line">               best_f1 = F1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">131</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> phase == <span class="hljs-string">'val'</span> <span class="hljs-keyword">and</span> acc &gt; best_acc_test:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">132</span></pre></td><td class="code"><pre><span class="line">               best_acc_test = acc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">133</span></pre></td><td class="code"><pre><span class="line">           <span class="hljs-keyword">if</span> phase == <span class="hljs-string">'train'</span> <span class="hljs-keyword">and</span> acc &gt; best_acc_train:</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">134</span></pre></td><td class="code"><pre><span class="line">               best_acc_train = acc</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">135</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment">#best_model_wts = copy.deepcopy(model.state_dict())</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">136</span></pre></td><td class="code"><pre><span class="line">               <span class="hljs-comment">#torch.save(model.state_dict(), '/content/drive/My Drive/Colab Notebooks/bert_model_test_f1.pth')</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">137</span></pre></td><td class="code"><pre><span class="line">       print()</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">138</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">139</span></pre></td><td class="code"><pre><span class="line">   time_elapsed = time.time() - since</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">140</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">'Training complete in &#123;:.0f&#125;m &#123;:.0f&#125;s'</span>.format(</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">141</span></pre></td><td class="code"><pre><span class="line">       time_elapsed // <span class="hljs-number">60</span>, time_elapsed % <span class="hljs-number">60</span>))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">142</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">"Parament setting: "</span>)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">143</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">"cased: "</span>,par_cased)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">144</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">"cleanup: "</span>,par_cleanup)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">145</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">"eda: "</span>,par_eda)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">146</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">'Best train Acc: &#123;:4f&#125;'</span>.format(float(best_acc_train)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">147</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">'Best test Acc: &#123;:4f&#125;'</span>.format(float(best_acc_test)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">148</span></pre></td><td class="code"><pre><span class="line">   print(<span class="hljs-string">'Best f1 score: &#123;:4f&#125;'</span>.format(float(best_f1)))</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">149</span></pre></td><td class="code"><pre><span class="line">   <span class="hljs-comment"># load best model weights</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">150</span></pre></td><td class="code"><pre><span class="line">   model.load_state_dict(best_model_wts)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">151</span></pre></td><td class="code"><pre><span class="line">   <span class="hljs-keyword">return</span> model</span></pre></td></tr></table></figure>
<h3 id="4-Final-output"><a href="#4-Final-output" class="headerlink" title="4. Final output"></a>4. Final output</h3><h4 id="4-1-Model-details"><a href="#4-1-Model-details" class="headerlink" title="4.1 Model details"></a>4.1 Model details</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">print(model)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">model.to(device)</span></pre></td></tr></table></figure>
<h4 id="4-2-F1-and-other-details"><a href="#4-2-F1-and-other-details" class="headerlink" title="4.2 F1 and other details"></a>4.2 F1 and other details</h4><figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">model_ft1 = train_model(model, criterion, optimizer_ft, exp_lr_scheduler,num_epochs=<span class="hljs-number">10</span>)</span></pre></td></tr></table></figure>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/NLP/" rel="tag">NLP</a>, <a class="has-link-grey -link" href="/tags/Python/" rel="tag">Python</a>
                </div>
            </div>
        </div>
        
        
        <!-- ÈÉ®ÂàÜÂèÇËÄÉËá™https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
            <ul class="post-copyright">
            <li><strong>Êú¨ÊñáÊ†áÈ¢òÔºö</strong><a href="https://nave.work/Google-BERT-on-fake-or-real-news-dataset.html">Google-BERT-on-fake_or_real-news-dataset</a></li>
            <li><strong>Êú¨Êñá‰ΩúËÄÖÔºö</strong><a href="https://nave.work">Wong Evan</a></li>
            <li><strong>Êú¨ÊñáÈìæÊé•Ôºö</strong><a href="https://nave.work/Google-BERT-on-fake-or-real-news-dataset.html">https://nave.work/Google-BERT-on-fake-or-real-news-dataset.html</a></li>
            <li><strong>ÁâàÊùÉÂ£∞ÊòéÔºö</strong>Êú¨ÂçöÂÆ¢ÊâÄÊúâÊñáÁ´†Èô§ÁâπÂà´Â£∞ÊòéÂ§ñÔºåÂùáÈááÁî® <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC 4.0</a> ËÆ∏ÂèØÂçèËÆÆ„ÄÇËΩ¨ËΩΩËØ∑Ê≥®ÊòéÂá∫Â§ÑÔºÅ
            </li>
            </ul>
            <br>
            <span class="is-size-6 has-text-grey has-mr-7">#&nbsp;Recommend Posts</span>
<br>

    &nbsp;1.<a href="/1-1-2019%20-%2012-31-2019.html" class="is-size-6" target="_blank">1/1/2019 - 12/31/2019</a><br>

    &nbsp;2.<a href="/82%20%E5%B9%B4%E7%94%9F%E7%9A%84%E9%87%91%E6%99%BA%E8%8B%B1.html" class="is-size-6" target="_blank">82 Âπ¥ÁîüÁöÑÈáëÊô∫Ëã±</a><br>

    &nbsp;3.<a href="/Hexo%E4%B8%BB%E9%A2%98%E6%8A%98%E8%85%BE%E6%97%A5%E8%AE%B0-%E4%BA%8C-%E6%B7%BB%E5%8A%A0%E8%B1%86%E7%93%A3%E5%92%8C%E8%81%8A%E5%A4%A9%E6%8F%92%E4%BB%B6.html" class="is-size-6" target="_blank">Hexo‰∏ªÈ¢òÊäòËÖæÊó•ËÆ∞(‰∫å) Ê∑ªÂä†Ë±ÜÁì£ÂíåËÅäÂ§©Êèí‰ª∂</a><br>

    &nbsp;4.<a href="/Hexo%E4%B8%BB%E9%A2%98%E6%8A%98%E8%85%BE%E6%97%A5%E8%AE%B0-%E4%BB%8Ecactus%E5%88%B0icarus.html" class="is-size-6" target="_blank">Hexo‰∏ªÈ¢òÊäòËÖæÊó•ËÆ∞(‰∏Ä) ‰ªécactusÂà∞icarus</a><br>

    &nbsp;5.<a href="/%E4%B8%80%E4%BA%A9%E4%B8%89%E5%88%86%E5%9C%B0%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0%E8%84%9A%E6%9C%AC.html" class="is-size-6" target="_blank">‰∏Ä‰∫©‰∏âÂàÜÂú∞Ëá™Âä®Á≠æÂà∞ËÑöÊú¨</a><br>

            <br>
        
        
        
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5dce993f5619c300129aeaa0&amp;product=inline-share-buttons&amp;cms=sop' async='async'></script>

        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Like this article? Support the author with</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>Wechat</span>
    <div class="qrcode"><img src="https://raw.githubusercontent.com/NavePnow/blog_photo/master/1234.JPG" alt="Wechat"></div>
</a>

                
                <!-- Visit https://www.paypal.com/donate/buttons/ to get your donate button -->

<a class="button is-warning donate" onclick="document.getElementById(&#39;paypal-donate-form&#39;).submit()">
    <span class="icon is-small">
        <i class="fab fa-paypal"></i>
    </span>
    <span>Paypal</span>
</a>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank" id="paypal-donate-form">
    <input type="hidden" name="cmd" value="_donations" />
    <input type="hidden" name="business" value="evan.wong.stu@gmail.com" />
    <input type="hidden" name="currency_code" value="USD" />
</form>

                
                
<a class="button is-danger donate" href="https://www.patreon.com/navepnow" target="_blank">
    <span class="icon is-small">
        <i class="fab fa-patreon"></i>
    </span>
    <span>Patreon</span>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/Sep-2-2019.html">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Sep 2, 2019</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/Fake-News-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89.html">
                <span class="level-item">Fake News Â≠¶‰π†Á¨îËÆ∞ÔºàÂõõÔºâProject-Summary NLP-Summary</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<script>
    var disqus_config = function () {
        this.page.url = 'https://nave.work/Google-BERT-on-fake-or-real-news-dataset.html';
        this.page.identifier = 'Google-BERT-on-fake-or-real-news-dataset.html';
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'owtpnow' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </div>
</div>
</div>
                
        




<div class="column is-4-tablet is-3-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="https://www.gravatar.com/avatar/3a923126d97f89b4beadcf109cbddc11?s=128" alt="Evan">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Evan
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        Drunkard
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Taiwan</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Posts
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            36
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Categories
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            5
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tags
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            4
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://twitter.com/darrenlepe" target="_blank">
                Follow</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Telegram" href="https://t.me/Leped_Bot">
                
                <i class="fab fa-telegram"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/NavePnow">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Medium" href="https://medium.com/@owtpnow">
                
                <i class="fab fa-medium"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="https://navepnow.github.io/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Email" href="mailto:help@evanwong.org">
                
                <i class="fa fa-envelope"></i>
                
            </a>
            
        </div>
        
        <hr>
        <p id="evan">‰øÆÂ≠ê‰πüÂ•ΩÔºåËøúÈáé‰πüÂ•ΩÔºåÂØπ‰∫éÊÉÖÊÑü‰∏ñÁïåÂèëÁîüÁöÑ‰∫ãÔºåÂæàÈöæÁÆÄÂçï‰ª•ÂØπÂíåÈîôÊù•Ë°°ÈáèÔºåÂú®ËøôÊ†∑ÁöÑ‰∏ñÁïåÈáåÊ≤âÊµÆÔºåÈ£òËêΩÁöÑÊòØÊÉÖÊÑüÔºå‰∏çË¥•ÁöÑÊÄªÊòØÊØèÂπ¥ÁõõÂºÄÁöÑÊ®±Ëä±„ÄÇ    --„ÄäÊÉÖ‰∫∫„Äã</p>
    </div>
</div>
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    Catalogue
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#Showcase">
        <span class="has-mr-6">1</span>
        <span>Showcase</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-Pipeline">
        <span class="has-mr-6">1.1</span>
        <span>1. Pipeline</span>
        </a></li><li>
        <a class="is-flex" href="#2-Part1-Data-processing">
        <span class="has-mr-6">1.2</span>
        <span>2. Part1: Data processing</span>
        </a></li><li>
        <a class="is-flex" href="#3-Part2-Bert-Model">
        <span class="has-mr-6">1.3</span>
        <span>3. Part2: Bert Model</span>
        </a></li><li>
        <a class="is-flex" href="#4-Part3-Result">
        <span class="has-mr-6">1.4</span>
        <span>4. Part3: Result</span>
        </a></li><li>
        <a class="is-flex" href="#5-Part4-Reference">
        <span class="has-mr-6">1.5</span>
        <span>5. Part4: Reference</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Implementation">
        <span class="has-mr-6">2</span>
        <span>Implementation</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-Preparation">
        <span class="has-mr-6">2.1</span>
        <span>1. Preparation</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-1-Set-parameters-and-install-and-load-required-package">
        <span class="has-mr-6">2.1.1</span>
        <span>1.1 Set parameters and install and load required package</span>
        </a></li><li>
        <a class="is-flex" href="#1-2-Set-tokenizer">
        <span class="has-mr-6">2.1.2</span>
        <span>1.2 Set tokenizer</span>
        </a></li><li>
        <a class="is-flex" href="#1-3-Define-Bert-Config">
        <span class="has-mr-6">2.1.3</span>
        <span>1.3 Define Bert Config</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#2-Dataset-Processing">
        <span class="has-mr-6">2.2</span>
        <span>2. Dataset Processing</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-1-Read-the-data-and-convert-label-into-binary-text">
        <span class="has-mr-6">2.2.1</span>
        <span>2.1 Read the data and convert label into binary text</span>
        </a></li><li>
        <a class="is-flex" href="#2-2-Combine-the-title-and-text">
        <span class="has-mr-6">2.2.2</span>
        <span>2.2 Combine the title and text</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-Use-regular-expression-to-drop-non-sentence">
        <span class="has-mr-6">2.2.3</span>
        <span>2.3 Use regular expression to drop non-sentence</span>
        </a></li><li>
        <a class="is-flex" href="#2-4-Use-EDA-method-to-augment-the-text">
        <span class="has-mr-6">2.2.4</span>
        <span>2.4 Use EDA method to augment the text</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#3-Google-Bert">
        <span class="has-mr-6">2.3</span>
        <span>3. Google Bert</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#3-1-Create-data-dictionary">
        <span class="has-mr-6">2.3.1</span>
        <span>3.1 Create data dictionary</span>
        </a></li><li>
        <a class="is-flex" href="#3-2-Define-the-train-model">
        <span class="has-mr-6">2.3.2</span>
        <span>3.2 Define the train model</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#4-Final-output">
        <span class="has-mr-6">2.4</span>
        <span>4. Final output</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#4-1-Model-details">
        <span class="has-mr-6">2.4.1</span>
        <span>4.1 Model details</span>
        </a></li><li>
        <a class="is-flex" href="#4-2-F1-and-other-details">
        <span class="has-mr-6">2.4.2</span>
        <span>4.2 F1 and other details</span>
        </a></li></ul></li></ul></li></ul>
            </div>
        </div>
    </div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Links
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://t.me/Leped_Channel" target="_blank">
                    <span class="level-left">
                        <span class="level-item">TG_Channel</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">t.me</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>

    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Categories
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Distributed-System/">
            <span class="level-start">
                <span class="level-item">Distributed System</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/FakeNews/">
            <span class="level-start">
                <span class="level-item">FakeNews</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/MARL/">
            <span class="level-start">
                <span class="level-item">MARL</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%97%A7%E7%9A%84%E6%96%87/">
            <span class="level-start">
                <span class="level-item">ÊóßÁöÑÊñá</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">13</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/%E6%97%A7%E7%9A%84%E6%A2%A6/">
            <span class="level-start">
                <span class="level-item">ÊóßÁöÑÊ¢¶</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Tag Cloud
        </h3>
        <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/NLP/" style="font-size: 15px;">NLP</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/RL/" style="font-size: 10px;">RL</a>
    </div>
</div>
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    Catalogue
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#Showcase">
        <span class="has-mr-6">1</span>
        <span>Showcase</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-Pipeline">
        <span class="has-mr-6">1.1</span>
        <span>1. Pipeline</span>
        </a></li><li>
        <a class="is-flex" href="#2-Part1-Data-processing">
        <span class="has-mr-6">1.2</span>
        <span>2. Part1: Data processing</span>
        </a></li><li>
        <a class="is-flex" href="#3-Part2-Bert-Model">
        <span class="has-mr-6">1.3</span>
        <span>3. Part2: Bert Model</span>
        </a></li><li>
        <a class="is-flex" href="#4-Part3-Result">
        <span class="has-mr-6">1.4</span>
        <span>4. Part3: Result</span>
        </a></li><li>
        <a class="is-flex" href="#5-Part4-Reference">
        <span class="has-mr-6">1.5</span>
        <span>5. Part4: Reference</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#Implementation">
        <span class="has-mr-6">2</span>
        <span>Implementation</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-Preparation">
        <span class="has-mr-6">2.1</span>
        <span>1. Preparation</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#1-1-Set-parameters-and-install-and-load-required-package">
        <span class="has-mr-6">2.1.1</span>
        <span>1.1 Set parameters and install and load required package</span>
        </a></li><li>
        <a class="is-flex" href="#1-2-Set-tokenizer">
        <span class="has-mr-6">2.1.2</span>
        <span>1.2 Set tokenizer</span>
        </a></li><li>
        <a class="is-flex" href="#1-3-Define-Bert-Config">
        <span class="has-mr-6">2.1.3</span>
        <span>1.3 Define Bert Config</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#2-Dataset-Processing">
        <span class="has-mr-6">2.2</span>
        <span>2. Dataset Processing</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#2-1-Read-the-data-and-convert-label-into-binary-text">
        <span class="has-mr-6">2.2.1</span>
        <span>2.1 Read the data and convert label into binary text</span>
        </a></li><li>
        <a class="is-flex" href="#2-2-Combine-the-title-and-text">
        <span class="has-mr-6">2.2.2</span>
        <span>2.2 Combine the title and text</span>
        </a></li><li>
        <a class="is-flex" href="#2-3-Use-regular-expression-to-drop-non-sentence">
        <span class="has-mr-6">2.2.3</span>
        <span>2.3 Use regular expression to drop non-sentence</span>
        </a></li><li>
        <a class="is-flex" href="#2-4-Use-EDA-method-to-augment-the-text">
        <span class="has-mr-6">2.2.4</span>
        <span>2.4 Use EDA method to augment the text</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#3-Google-Bert">
        <span class="has-mr-6">2.3</span>
        <span>3. Google Bert</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#3-1-Create-data-dictionary">
        <span class="has-mr-6">2.3.1</span>
        <span>3.1 Create data dictionary</span>
        </a></li><li>
        <a class="is-flex" href="#3-2-Define-the-train-model">
        <span class="has-mr-6">2.3.2</span>
        <span>3.2 Define the train model</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#4-Final-output">
        <span class="has-mr-6">2.4</span>
        <span>4. Final output</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#4-1-Model-details">
        <span class="has-mr-6">2.4.1</span>
        <span>4.1 Model details</span>
        </a></li><li>
        <a class="is-flex" href="#4-2-F1-and-other-details">
        <span class="has-mr-6">2.4.2</span>
        <span>4.2 F1 and other details</span>
        </a></li></ul></li></ul></li></ul>
            </div>
        </div>
    </div>

    
    
        <div class="column-right-shadow  ">
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Recent
        </h3>
        
        <article class="media">
            
            <a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9B%9B-Ray%20%E5%AE%9E%E6%88%98%20--%20%E5%B0%86CNN%E7%BD%91%E7%BB%9C%E6%94%B9%E5%86%99%E6%88%90%20Ray.html" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=800&amp;q=60" alt="ÂàÜÂ∏ÉÂºèËÆ°ÁÆóÂ≠¶‰π†Á¨îËÆ∞(Âõõ) Ray ÂÆûÊàò -- Â∞ÜCNNÁΩëÁªúÊîπÂÜôÊàê Ray">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-02-05T03:01:35.000Z">2020-02-05</time></div>
                    <a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%9B%9B-Ray%20%E5%AE%9E%E6%88%98%20--%20%E5%B0%86CNN%E7%BD%91%E7%BB%9C%E6%94%B9%E5%86%99%E6%88%90%20Ray.html" class="title has-link-black-ter is-size-6 has-text-weight-normal">ÂàÜÂ∏ÉÂºèËÆ°ÁÆóÂ≠¶‰π†Á¨îËÆ∞(Âõõ) Ray ÂÆûÊàò -- Â∞ÜCNNÁΩëÁªúÊîπÂÜôÊàê Ray</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Distributed-System/">Distributed System</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/82%20%E5%B9%B4%E7%94%9F%E7%9A%84%E9%87%91%E6%99%BA%E8%8B%B1.html" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://images.unsplash.com/photo-1492725764893-90b379c2b6e7?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2700&amp;q=80" alt="82 Âπ¥ÁîüÁöÑÈáëÊô∫Ëã±">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-01-28T16:31:39.000Z">2020-01-29</time></div>
                    <a href="/82%20%E5%B9%B4%E7%94%9F%E7%9A%84%E9%87%91%E6%99%BA%E8%8B%B1.html" class="title has-link-black-ter is-size-6 has-text-weight-normal">82 Âπ¥ÁîüÁöÑÈáëÊô∫Ëã±</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E6%97%A7%E7%9A%84%E6%96%87/">ÊóßÁöÑÊñá</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/1-1-2019%20-%2012-31-2019.html" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://images.unsplash.com/photo-1475137979732-b349acb6b7e3?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=2550&amp;q=80" alt="1/1/2019 - 12/31/2019">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-31T15:20:23.000Z">2019-12-31</time></div>
                    <a href="/1-1-2019%20-%2012-31-2019.html" class="title has-link-black-ter is-size-6 has-text-weight-normal">1/1/2019 - 12/31/2019</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E6%97%A7%E7%9A%84%E6%96%87/">ÊóßÁöÑÊñá</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/%E5%BE%AE%E5%8D%9A%E8%B6%85%E8%AF%9D%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0%E8%84%9A%E6%9C%AC.html" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://cdn.jsdelivr.net/gh/NavePnow/blog_photo@private/IMG_1189.JPG" alt="ÂæÆÂçöË∂ÖËØùËá™Âä®Á≠æÂà∞ËÑöÊú¨">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-21T03:21:23.000Z">2019-12-21</time></div>
                    <a href="/%E5%BE%AE%E5%8D%9A%E8%B6%85%E8%AF%9D%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%88%B0%E8%84%9A%E6%9C%AC.html" class="title has-link-black-ter is-size-6 has-text-weight-normal">ÂæÆÂçöË∂ÖËØùËá™Âä®Á≠æÂà∞ËÑöÊú¨</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89-Ray%20%E2%80%94API%20&%20Actors.html" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://images.unsplash.com/photo-1434030216411-0b793f4b4173?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=800&amp;q=60" alt="ÂàÜÂ∏ÉÂºèËÆ°ÁÆóÂ≠¶‰π†Á¨îËÆ∞(‰∏â) Ray ‚ÄîAPI &amp; Actors">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-21T03:01:35.000Z">2019-11-21</time></div>
                    <a href="/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E4%B8%89-Ray%20%E2%80%94API%20&%20Actors.html" class="title has-link-black-ter is-size-6 has-text-weight-normal">ÂàÜÂ∏ÉÂºèËÆ°ÁÆóÂ≠¶‰π†Á¨îËÆ∞(‰∏â) Ray ‚ÄîAPI &amp; Actors</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Distributed-System/">Distributed System</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Archives
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">February 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">December 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/12/">
                <span class="level-start">
                    <span class="level-item">December 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tags
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JavaScript/">
                        <span class="tag">JavaScript</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NLP/">
                        <span class="tag">NLP</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python/">
                        <span class="tag">Python</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/RL/">
                        <span class="tag">RL</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="Google-BERT-on-fake_or_real-news-dataset" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 Wong Evan&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                <br>
                <span id="busuanzi_container_site_uv">
                <!-- Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                <br> -->
                <span id="busuanzi_container_site_pv">
                    Visited by <span id="busuanzi_value_site_uv"></span> users with <span id="busuanzi_value_site_pv"></span> times
                </span>
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution-NonCommercial 4.0 International" href="https://creativecommons.org/licenses/by-nc/4.0/">
                        
                        <i class="fab fa-creative-commons-nc"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
<script src="/js/animation.js"></script>

    
    
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>

    
    
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>

    
    <script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>
    
    
<a id="back-to-top" title="Back to Top" href="javascript:;" target="_blank" rel="noopener">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>

    
    
    
    
    
    
    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
    <script src="//code.tidio.co/pcdpgnngpleui8os7yv6lt9qgdsnel9a.js" async></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>